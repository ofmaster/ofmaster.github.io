!function(e){if(!e.BX.localStorage){var t=e.BX,r=null,o=null,a="_bxCurrentKey",l=!1;t.localStorage=function(){this.keyChanges={},t.bind(t.browser.IsIE()&&!t.browser.IsIE9()?document:e,"storage",t.proxy(this._onchange,this)),setInterval(t.delegate(this._clear,this),5e3)},t.localStorage.checkBrowser=function(){return l},t.localStorage.set=function(e,r,o){return t.localStorage.instance().set(e,r,o)},t.localStorage.get=function(e){return t.localStorage.instance().get(e)},t.localStorage.remove=function(e){return t.localStorage.instance().remove(e)},t.localStorage.instance=function(){if(!r){var e=t.localStorage.checkBrowser();r="native"==e?new t.localStorage:"ie8"==e?new t.localStorageIE8:"ie7"==e?new t.localStorageIE7:{set:t.DoNothing,get:function(){return null},remove:t.DoNothing}}return r},t.localStorage.prototype.prefix=function(){return o||(o="bx"+t.message("USER_ID")+"-"+(t.message("SITE_ID")||"admin")+"-"),o},t.localStorage.prototype._onchange=function(r){if((r=r||e.event).key)if(t.browser.DetectIeVersion()>0&&this.keyChanges[r.key])this.keyChanges[r.key]=!1;else if(r.key&&r.key.substring(0,this.prefix().length)==this.prefix()){var o={key:r.key.substring(this.prefix().length,r.key.length),value:r.newValue?this._decode(r.newValue.substring(11,r.newValue.length)):null,oldValue:r.oldValue?this._decode(r.oldValue.substring(11,r.oldValue.length)):null};switch(o.key){case"BXGCE":o.value&&t.onCustomEvent(o.value.e,o.value.p);break;default:r.newValue&&t.onCustomEvent(e,"onLocalStorageSet",[o]),r.oldValue&&!r.newValue&&t.onCustomEvent(e,"onLocalStorageRemove",[o]),t.onCustomEvent(e,"onLocalStorageChange",[o])}}},t.localStorage.prototype._clear=function(){var e,t,r=+new Date;for(t=0;t<localStorage.length;t++){if("bx"==(e=localStorage.key(t)).substring(0,2))r>=1e3*localStorage.getItem(e).split(":",1)&&localStorage.removeItem(e)}},t.localStorage.prototype._encode=function(e){return e="object"==typeof e?JSON.stringify(e):e.toString()},t.localStorage.prototype._decode=function(e){var t=null;if(e)try{t=JSON.parse(e)}catch(r){t=e}return t},t.localStorage.prototype._trigger_error=function(e,r,o,a){t.onCustomEvent(this,"onLocalStorageError",[e,{key:r,value:o,ttl:a}])},t.localStorage.prototype.set=function(e,t,r){if((!r||r<=0)&&(r=60),null==e||null==e||null==t)return!1;this.keyChanges[this.prefix()+e]=!0;try{localStorage.setItem(this.prefix()+e,Math.round(+new Date/1e3)+r+":"+this._encode(t))}catch(o){this._trigger_error(o,e,t,r)}},t.localStorage.prototype.get=function(e){var t=localStorage.getItem(this.prefix()+e);if(t){var r=1e3*t.split(":",1);if(+new Date<=r)return t=t.substring(11,t.length),this._decode(t)}return null},t.localStorage.prototype.remove=function(e){this.keyChanges[this.prefix()+e]=!0,localStorage.removeItem(this.prefix()+e)},t.localStorageIE7=function(){this.NS="BXLocalStorage",this.__current_state={},this.keyChanges={},t.ready(t.delegate(this._Init,this))},t.extend(t.localStorageIE7,t.localStorage),t.localStorageIE7.prototype._Init=function(){this.storage_element=document.body.appendChild(t.create("DIV")),this.storage_element.addBehavior("#default#userData"),this.storage_element.load(this.NS);for(var e=this.storage_element.xmlDocument,r=e.firstChild.attributes.length,o=0;o<r;o++)if(e.firstChild.attributes[o]){var a=e.firstChild.attributes[o].nodeName;a.substring(0,this.prefix().length)==this.prefix()&&(this.__current_state[a]=e.firstChild.attributes[o].nodeValue)}setInterval(t.delegate(this._Listener,this),500),setInterval(t.delegate(this._clear,this),5e3)},t.localStorageIE7.prototype._Listener=function(e){this.storage_element.load(this.NS);var t,r,o,a=this.storage_element.xmlDocument,l=a.firstChild.attributes.length,s={},i=[];for(t=0;t<l;t++)a.firstChild.attributes[t]&&(r=a.firstChild.attributes[t].nodeName).substring(0,this.prefix().length)==this.prefix()&&(o=a.firstChild.attributes[t].nodeValue,this.__current_state[r]!=o&&i.push({key:r,newValue:o,oldValue:this.__current_state[r]}),s[r]=o,delete this.__current_state[r]);for(t in this.__current_state)this.__current_state.hasOwnProperty(t)&&i.push({key:t,newValue:void 0,oldValue:this.__current_state[t]});for(this.__current_state=s,t=0;t<i.length;t++)this._onchange(i[t])},t.localStorageIE7.prototype._clear=function(){this.storage_element.load(this.NS);var e,t,r=this.storage_element.xmlDocument,o=r.firstChild.attributes.length,a=+new Date;for(e=0;e<o;e++)r.firstChild.attributes[e]&&"bx"==(t=r.firstChild.attributes[e].nodeName).substring(0,2)&&a>=1e3*r.firstChild.attributes[e].nodeValue.split(":",1)&&r.firstChild.removeAttribute(t);this.storage_element.save(this.NS)},t.localStorageIE7.prototype.set=function(e,t,r){(!r||r<=0)&&(r=60);try{this.storage_element.load(this.NS);var o=this.storage_element.xmlDocument;this.keyChanges[this.prefix()+e]=!0,o.firstChild.setAttribute(this.prefix()+e,Math.round(+new Date/1e3)+r+":"+this._encode(t)),this.storage_element.save(this.NS)}catch(o){this._trigger_error(o,e,t,r)}},t.localStorageIE7.prototype.get=function(e){this.storage_element.load(this.NS);var t=this.storage_element.xmlDocument.firstChild.getAttribute(this.prefix()+e);if(t){var r=1e3*t.split(":",1);if(+new Date<=r)return t=t.substring(11,t.length),this._decode(t)}return null},t.localStorageIE7.prototype.remove=function(e){this.storage_element.load(this.NS),this.storage_element.xmlDocument.firstChild.removeAttribute(this.prefix()+e),this.keyChanges[this.prefix()+e]=!0,this.storage_element.save(this.NS)},t.localStorageIE8=function(){this.key=a,this.currentKey=null,this.currentValue=null,t.localStorageIE8.superclass.constructor.apply(this)},t.extend(t.localStorageIE8,t.localStorage),t.localStorageIE8.prototype._onchange=function(e){if(null==this.currentKey)this.currentKey=localStorage.getItem(this.key),this.currentKey&&(this.currentValue=localStorage.getItem(this.prefix()+this.currentKey));else{if(e={key:this.prefix()+this.currentKey,newValue:localStorage.getItem(this.prefix()+this.currentKey),oldValue:this.currentValue},this.currentKey=null,this.currentValue=null,this.keyChanges[e.key])return void(this.keyChanges[e.key]=!1);t.localStorageIE8.superclass._onchange.apply(this,[e])}},t.localStorageIE8.prototype.set=function(e,r,o){this.currentKey=null,this.keyChanges[this.prefix()+e]=!0;try{localStorage.setItem(this.key,e),t.localStorageIE8.superclass.set.apply(this,arguments)}catch(t){this._trigger_error(t,e,r,o)}},t.localStorageIE8.prototype.remove=function(e){this.currentKey=null,this.keyChanges[this.prefix()+e]=!0,localStorage.setItem(this.key,e),t.localStorageIE8.superclass.remove.apply(this,arguments)},t.onGlobalCustomEvent=function(e,r,o){t.localStorage.checkBrowser()&&t.localStorage.set("BXGCE",{e:e,p:r},1),o||t.onCustomEvent(e,r)};try{l=!!localStorage.setItem}catch(e){}if(l){l="native";var s=t.browser.IsIE()&&!t.browser.IsIE9()?document:e,i=function(r){void 0===(r||e.event).key&&(l="ie8"),t.unbind(s,"storage",i),t.localStorage.instance()};t.bind(s,"storage",i),localStorage.setItem(a,null)}else t.browser.IsIE7()&&(l="ie7",t.localStorage.instance())}}(window);