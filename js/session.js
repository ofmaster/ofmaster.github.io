function CBXSession(){var e=this;this.mess={},this.timeout=null,this.sessid=null,this.bShowMess=!0,this.dateStart=new Date,this.dateInput=new Date,this.dateCheck=new Date,this.activityInterval=0,this.notifier=null,this.Expand=function(t,s,i,n){this.timeout=t,this.sessid=s,this.bShowMess=i,this.key=n,BX.ready((function(){BX.bind(document,"keypress",e.OnUserInput),BX.bind(document.body,"mousemove",e.OnUserInput),BX.bind(document.body,"click",e.OnUserInput),setTimeout(e.CheckSession,1e3*(e.timeout-60))}))},this.OnUserInput=function(){var t=new Date;e.dateInput.setTime(t.valueOf())},this.CheckSession=function(){if(!((new Date).valueOf()-e.dateCheck.valueOf()<3e4)){e.activityInterval=Math.round((e.dateInput.valueOf()-e.dateStart.valueOf())/1e3),e.dateStart.setTime(e.dateInput.valueOf());var t=e.activityInterval>e.timeout?e.timeout-60:e.activityInterval,s={method:"GET",dataType:"html",url:"/bitrix/tools/public_session.php?sessid="+e.sessid+"&interval="+t+"&k="+e.key,data:"",onsuccess:function(t){e.CheckResult(t)},lsId:"sess_expand",lsTimeout:60};t>0&&(s.lsForce=!0),BX.ajax(s)}},this.CheckResult=function(t){if("SESSION_EXPIRED"==t){if(e.bShowMess){if(!e.notifier){e.notifier=document.body.appendChild(BX.create("DIV",{props:{className:"bx-session-message"},style:{top:"0px"},html:'<a class="bx-session-message-close" href="javascript:bxSession.Close()"></a>'+e.mess.messSessExpired}));var s=BX.GetWindowScrollPos(),i=BX.GetWindowInnerSize();e.notifier.style.left=parseInt(s.scrollLeft+i.innerWidth/2-parseInt(e.notifier.clientWidth)/2)+"px",BX.browser.IsIE()?(e.notifier.style.top=s.scrollTop+"px",BX.bind(window,"scroll",(function(){var t=BX.GetWindowScrollPos();e.notifier.style.top=t.scrollTop+"px"}))):e.notifier.style.position="fixed"}e.notifier.style.display=""}}else{var n;n="SESSION_CHANGED"==t?e.timeout-60:e.activityInterval<60?60:e.activityInterval>e.timeout?e.timeout-60:e.activityInterval;var o=new Date;e.dateCheck.setTime(o.valueOf()),setTimeout(e.CheckSession,1e3*n)}},this.Close=function(){this.notifier.style.display="none"}}var bxSession=new CBXSession;